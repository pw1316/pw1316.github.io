---
layout: page
title: 强化模拟
date: 2025-11-15 20:28:24 +0800
mdate: 2025-11-15 20:28:24 +0800
---

# 规则

- 初始概率 $$\alpha$$。每次失败概率会线性增加，最多增加1倍的初始概率，$$K$$ 次失败后到达上限
- 每点一手会增加气息，增加值和初始概率成正比关系，设为 $$\eta$$。当气息累计大于等于 $$M$$，下次必定成功
- 可以投入精炼辅助，额外增加概率和失败气息获取。最高投入 $$N$$ 颗，增加1倍概率和气息。增加量和投入数量呈线性关系
- 可以投入书，额外增加概率和失败气息获取。最高投入1本，增加1倍概率和气息

# 消耗

- 成长消耗：银币；碎片
- 单次消耗：破坏/守护石；银币；碎片；突破石；金币
- 材料价格统一计为 $$G_1$$
- 精炼单价为 $$G_2$$
- 书单价为 $$G_3$$

# 公式

第 $$i$$ 手，已有气息为 $$b_i$$，投入精炼和书数量分别为 $$x_i y_i$$，成功率为 $$p_i$$，消耗为 $$g_i$$

$$b_1=0$$

$$b_i=b_{i-1}+\alpha\eta(1+\frac{x_{i-1}}{N}+y_{i-1})$$

$$p_i=\alpha(1+\min(\frac{i-1}{K},1)+\frac{x_i}{N}+y_i)$$

$$g_i=G_1+x_iG_2+y_iG_3$$

$$0\le x_i\le N$$

$$0\le y_i\le 1$$

# 计算

根据 $$b$$ 的递推式可以求出通项公式：

$$
\begin{aligned}
b_i&=b_1+\alpha\eta(i-1+\frac{1}{N}\sum_{j=1}^{i-1}{x_j}+\sum_{k=1}^{i-1}{y_k})\\
&=\alpha\eta(i-1+\frac{1}{N}{S_x}_{i-1}+{S_y}_{i-1})
\end{aligned}
$$

状态转移如下：

$$
\begin{aligned}
F(i-1,x,y)&=min(g_i+(1-p_i)F(i,x+x_i,y+y_i)|0\le x_i\le N,0\le y_i\le 1)\\
b_i&=\alpha\eta(i-1+x+y)\\
p_i&=\begin{cases}
\alpha(1+\min(\frac{i-1}{K},1)+\frac{x_i}{N}+y_i)&b_i<M\\
1&b_i\ge M
\end{cases}\\
g_i&=G_1+x_iG_2+y_iG_3
\end{aligned}
$$

表示在 $$i-1$$ 次失败，且已经投入 $$x$$ 颗精炼，$$y$$ 本书的情况下还要消耗多少。$$F(0,0,0)$$ 即最终结果
